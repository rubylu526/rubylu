<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教案影片資料庫</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 自定義滾動條樣式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        
        /* 簡單的淡入動畫 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* 視覺隱藏但保留在 DOM 中，用於 BGM 播放器 */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            border: 0;
        }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-800 overflow-hidden h-screen flex">

    <!-- 背景音樂播放器容器 (隱藏) -->
    <div id="bgm-container" class="visually-hidden"></div>

    <!-- 側邊欄 - 影片列表 -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 z-30 w-80 bg-white shadow-xl transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col">
        <!-- 側邊欄標題 -->
        <div class="p-4 border-b border-slate-100 flex items-center justify-between bg-emerald-600 text-white shrink-0">
            <div class="flex items-center space-x-2">
                <i data-lucide="book-open" class="w-6 h-6"></i>
                <h1 class="text-xl font-bold">教案資料庫</h1>
            </div>
            
            <div class="flex items-center space-x-2">
                <!-- 電腦版 BGM 開關 -->
                <button id="bgm-toggle-desktop" class="p-1.5 hover:bg-emerald-700 rounded-full transition-colors hidden md:block" title="背景音樂開關">
                    <i data-lucide="music" class="w-5 h-5"></i>
                </button>

                <button id="close-sidebar" class="md:hidden p-1 hover:bg-emerald-700 rounded">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
        </div>

        <!-- 列表容器 -->
        <div class="overflow-y-auto flex-1 p-3 space-y-2" id="video-list">
            <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 px-2">
                播放列表 (<span id="video-count">0</span>)
            </div>
            <!-- 影片列表項目將由 JS 動態生成 -->
        </div>
    </aside>

    <!-- 主要內容區 -->
    <div class="flex-1 flex flex-col h-full overflow-hidden w-full relative">
        
        <!-- 手機版 Header -->
        <header class="md:hidden h-14 bg-white border-b flex items-center px-4 justify-between shadow-sm z-20 shrink-0">
            <div class="flex items-center min-w-0 flex-1 mr-2">
                 <!-- 手機版 BGM 開關 -->
                 <button id="bgm-toggle-mobile" class="p-2 mr-2 text-emerald-600 bg-emerald-50 rounded-full" title="背景音樂開關">
                    <i data-lucide="music" class="w-5 h-5"></i>
                </button>
                <span class="font-bold text-slate-700 truncate" id="mobile-current-title">載入中...</span>
            </div>
            <button id="open-sidebar" class="p-2 -mr-2 text-slate-600">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </header>

        <!-- 影片播放區域 -->
        <main class="flex-1 overflow-y-auto bg-slate-100 p-4 md:p-8">
            <div class="max-w-5xl mx-auto space-y-6">
                
                <!-- 播放器容器 -->
                <div class="bg-black rounded-xl overflow-hidden shadow-2xl aspect-video w-full relative group">
                    <iframe
                        id="youtube-player"
                        class="w-full h-full"
                        src=""
                        title="YouTube video player"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen
                    ></iframe>
                </div>

                <!-- 影片資訊卡 -->
                <div id="info-card" class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 animate-fade-in">
                    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span id="video-category" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800">
                                    類別
                                </span>
                                <span class="flex items-center text-xs text-slate-500">
                                    <i data-lucide="clock" class="w-3 h-3 mr-1"></i>
                                    <span id="video-duration">時間</span>
                                </span>
                            </div>
                            <h2 id="video-title" class="text-2xl font-bold text-slate-900 mb-2">標題</h2>
                            <p id="video-description" class="text-slate-600 leading-relaxed">
                                說明文字
                            </p>
                        </div>
                        
                        <div class="flex-shrink-0 bg-slate-50 p-4 rounded-lg border border-slate-100 min-w-[200px] w-full md:w-auto">
                            <h4 class="text-sm font-semibold text-slate-700 mb-3 flex items-center">
                                <i data-lucide="info" class="w-4 h-4 mr-2"></i>
                                教案資訊
                            </h4>
                            <ul class="text-sm text-slate-600 space-y-2">
                                <li class="flex justify-between">
                                    <span>適用對象:</span>
                                    <span class="font-medium text-slate-800">銀髮族/社區</span>
                                </li>
                                <li class="flex justify-between">
                                    <span>強度:</span>
                                    <span class="font-medium text-slate-800">低 ~ 中</span>
                                </li>
                                <li class="flex justify-between">
                                    <span>場地需求:</span>
                                    <span class="font-medium text-slate-800">室內平坦處</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- 遮罩 (手機版側邊欄打開時顯示) -->
    <div id="overlay" class="fixed inset-0 bg-black/50 z-20 hidden md:hidden glass-effect"></div>

    <script>
        // 資料數據
        const videos = [
            {
                id: 1,
                title: "吞嚥健康操 台語版",
                videoId: "ZYgjKHwyA4g",
                category: "口腔保健",
                duration: "約 5 分鐘",
                description: "透過簡單的口腔運動，幫助長者強化吞嚥肌群，預防嗆咳，適合用餐前進行。",
                icon: 'activity'
            },
            {
                id: 2,
                title: "益口銅身操",
                videoId: "qZ87nEuBR4E",
                category: "全身運動",
                duration: "約 10 分鐘",
                description: "結合口腔與肢體的綜合性健康操，促進血液循環與協調性。",
                icon: 'heart'
            },
            {
                id: 3,
                title: "五行健康操",
                videoId: "RKB4NxhENyY",
                category: "養生氣功",
                duration: "約 15 分鐘",
                description: "傳統五行概念結合現代體操，動作緩和，適合各年齡層進行日常保養。",
                icon: 'activity'
            },
            {
                id: 4,
                title: "高齡者健康操",
                videoId: "_w50TfdCmKU",
                category: "樂齡運動",
                duration: "約 12 分鐘",
                description: "專為高齡者設計的低強度運動，重點在於關節活動度與基礎肌力維持。",
                icon: 'heart'
            },
            {
                id: 5,
                title: "那魯灣舞曲",
                videoId: "pCA8u2KrwTg",
                category: "律動舞蹈",
                duration: "約 4 分鐘",
                description: "輕快活潑的原住民風格舞曲，適合帶動氣氛，增加活動樂趣。",
                icon: 'music'
            }
        ];

        let currentVideoId = videos[0].id;
        
        // 背景音樂設定
        const bgmConfig = {
            id: 'w75I_oSyiSw', // 您的背景音樂 ID
            isPlaying: true    // 預設開啟狀態
        };

        // DOM 元素引用
        const els = {
            sidebar: document.getElementById('sidebar'),
            videoList: document.getElementById('video-list'),
            videoCount: document.getElementById('video-count'),
            player: document.getElementById('youtube-player'),
            title: document.getElementById('video-title'),
            mobileTitle: document.getElementById('mobile-current-title'),
            desc: document.getElementById('video-description'),
            category: document.getElementById('video-category'),
            duration: document.getElementById('video-duration'),
            infoCard: document.getElementById('info-card'),
            overlay: document.getElementById('overlay'),
            openBtn: document.getElementById('open-sidebar'),
            closeBtn: document.getElementById('close-sidebar'),
            bgmContainer: document.getElementById('bgm-container'),
            bgmToggleDesktop: document.getElementById('bgm-toggle-desktop'),
            bgmToggleMobile: document.getElementById('bgm-toggle-mobile')
        };

        // 初始化
        function init() {
            els.videoCount.textContent = videos.length;
            renderList();
            loadVideo(videos[0]);
            
            // 初始化背景音樂
            initBgm();
            
            // 事件監聽
            els.openBtn.addEventListener('click', openSidebar);
            els.closeBtn.addEventListener('click', closeSidebar);
            els.overlay.addEventListener('click', closeSidebar);
            els.bgmToggleDesktop.addEventListener('click', toggleBgm);
            els.bgmToggleMobile.addEventListener('click', toggleBgm);

            // 初始化圖示
            lucide.createIcons();
        }

        // 初始化背景音樂播放器
        function initBgm() {
            updateBgmState();
        }

        // 切換背景音樂
        function toggleBgm() {
            bgmConfig.isPlaying = !bgmConfig.isPlaying;
            updateBgmState();
        }

        function updateBgmState() {
            const iconName = bgmConfig.isPlaying ? 'music' : 'volume-x';
            const opacityClass = bgmConfig.isPlaying ? 'opacity-100' : 'opacity-50';
            const playlistParam = `&playlist=${bgmConfig.id}`; // 單一影片循環需要 playlist 參數

            // 更新播放器 iframe
            if (bgmConfig.isPlaying) {
                // 嘗試自動播放：autoplay=1, loop=1
                els.bgmContainer.innerHTML = `
                    <iframe 
                        width="100" height="100" 
                        src="https://www.youtube.com/embed/${bgmConfig.id}?autoplay=1&loop=1${playlistParam}&playsinline=1&controls=0" 
                        title="Background Music"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    ></iframe>
                `;
            } else {
                els.bgmContainer.innerHTML = '';
            }

            // 更新按鈕狀態 (Desktop)
            els.bgmToggleDesktop.innerHTML = `<i data-lucide="${iconName}" class="w-5 h-5"></i>`;
            els.bgmToggleDesktop.className = `p-1.5 rounded-full transition-all duration-200 hidden md:block ${bgmConfig.isPlaying ? 'bg-emerald-500 hover:bg-emerald-400' : 'bg-emerald-700 hover:bg-emerald-600'}`;
            
            // 更新按鈕狀態 (Mobile)
            els.bgmToggleMobile.innerHTML = `<i data-lucide="${iconName}" class="w-5 h-5"></i>`;
            els.bgmToggleMobile.className = `p-2 mr-2 rounded-full transition-all duration-200 ${bgmConfig.isPlaying ? 'text-emerald-600 bg-emerald-100' : 'text-slate-400 bg-slate-100'}`;

            // 重新渲染圖示
            lucide.createIcons();
        }

        // 渲染列表
        function renderList() {
            els.videoList.innerHTML = ''; // 清空列表
            
            // 保留標題
            const headerDiv = document.createElement('div');
            headerDiv.className = "text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 px-2";
            headerDiv.textContent = `播放列表 (${videos.length})`;
            els.videoList.appendChild(headerDiv);

            videos.forEach(video => {
                const btn = document.createElement('button');
                const isSelected = video.id === currentVideoId;
                
                btn.className = `
                    w-full text-left p-3 rounded-lg transition-all duration-200 flex items-start space-x-3 group mb-2
                    ${isSelected 
                        ? 'bg-emerald-50 border-l-4 border-emerald-500 shadow-sm' 
                        : 'hover:bg-slate-100 border-l-4 border-transparent'}
                `;
                
                // 建立按鈕內部 HTML
                btn.innerHTML = `
                    <div class="relative flex-shrink-0 mt-1">
                        <img 
                            src="https://img.youtube.com/vi/${video.videoId}/default.jpg" 
                            alt="${video.title}"
                            class="w-24 h-18 object-cover rounded shadow-sm group-hover:shadow-md transition-shadow"
                        >
                        <div class="absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/10 rounded">
                            ${isSelected ? '<div class="bg-emerald-500 rounded-full p-1"><i data-lucide="play" class="w-3 h-3 text-white fill-current"></i></div>' : ''}
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="font-medium text-sm truncate ${isSelected ? 'text-emerald-800' : 'text-slate-700'}">
                            ${video.title}
                        </h3>
                        <div class="flex items-center mt-1 text-xs text-slate-500 space-x-2">
                            <span class="bg-slate-200 px-1.5 py-0.5 rounded text-slate-600">${video.category}</span>
                        </div>
                    </div>
                `;

                btn.onclick = () => {
                    currentVideoId = video.id;
                    loadVideo(video);
                    renderList(); 
                    lucide.createIcons();
                    
                    // 手機版自動收起
                    if (window.innerWidth < 768) {
                        closeSidebar();
                    }
                };

                els.videoList.appendChild(btn);
            });
        }

        // 載入影片內容
        function loadVideo(video) {
            // 更新 iframe
            els.player.src = `https://www.youtube.com/embed/${video.videoId}?autoplay=1&rel=0`;
            
            // 更新文字資訊
            els.title.textContent = video.title;
            els.mobileTitle.textContent = `目前播放：${video.title}`;
            els.desc.textContent = video.description;
            els.category.textContent = video.category;
            els.duration.textContent = video.duration;

            // 觸發資訊卡的重播動畫
            els.infoCard.classList.remove('animate-fade-in');
            void els.infoCard.offsetWidth; // trigger reflow
            els.infoCard.classList.add('animate-fade-in');
        }

        // 側邊欄控制
        function openSidebar() {
            els.sidebar.classList.remove('-translate-x-full');
            els.overlay.classList.remove('hidden');
        }

        function closeSidebar() {
            els.sidebar.classList.add('-translate-x-full');
            els.overlay.classList.add('hidden');
        }

        // 啟動
        init();

    </script>
</body>
</html>
